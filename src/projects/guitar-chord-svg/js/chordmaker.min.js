//     chordmaker.js 0.3.2
//     https://github.com/abelnation/chordmaker/
//     2016-04-13
//
//     Contributors:
//     Abel Allison (abel.allison@gmail.com)

!function(a,b){"function"==typeof define&&define.amd?define(["jquery","underscore","Raphael"],function(c,_,Raphael){return a.Chords=b(c,_,Raphael?Raphael:window.Raphael)}):a.Chords=b($,_,Raphael)}(this,function(a,_,Raphael){var b={};return function(a){var b={RERR:function(a,b){this.type=a,this.msg=b}},c=function(){};_.extend(c,{NUM_TONES:12,roots:["c","d","e","f","g","a","b"],root_values:[0,2,4,5,7,9,11],root_indices:{c:0,d:1,e:2,f:3,g:4,a:5,b:6},accidentals:["bb","b","n","#","##"],canonical_notes:["c","c#","d","d#","e","f","f#","g","g#","a","a#","b"],noteValues:{c:{root_index:0,int_val:0},cn:{root_index:0,int_val:0},"c#":{root_index:0,int_val:1},"c##":{root_index:0,int_val:2},cb:{root_index:0,int_val:11},cbb:{root_index:0,int_val:10},d:{root_index:1,int_val:2},dn:{root_index:1,int_val:2},"d#":{root_index:1,int_val:3},"d##":{root_index:1,int_val:4},db:{root_index:1,int_val:1},dbb:{root_index:1,int_val:0},e:{root_index:2,int_val:4},en:{root_index:2,int_val:4},"e#":{root_index:2,int_val:5},"e##":{root_index:2,int_val:6},eb:{root_index:2,int_val:3},ebb:{root_index:2,int_val:2},f:{root_index:3,int_val:5},fn:{root_index:3,int_val:5},"f#":{root_index:3,int_val:6},"f##":{root_index:3,int_val:7},fb:{root_index:3,int_val:4},fbb:{root_index:3,int_val:3},g:{root_index:4,int_val:7},gn:{root_index:4,int_val:7},"g#":{root_index:4,int_val:8},"g##":{root_index:4,int_val:9},gb:{root_index:4,int_val:6},gbb:{root_index:4,int_val:5},a:{root_index:5,int_val:9},an:{root_index:5,int_val:9},"a#":{root_index:5,int_val:10},"a##":{root_index:5,int_val:11},ab:{root_index:5,int_val:8},abb:{root_index:5,int_val:7},b:{root_index:6,int_val:11},bn:{root_index:6,int_val:11},"b#":{root_index:6,int_val:0},"b##":{root_index:6,int_val:1},bb:{root_index:6,int_val:10},bbb:{root_index:6,int_val:9}},diatonic_intervals:["unison","m2","M2","m3","M3","p4","dim5","p5","m6","M6","b7","M7","octave"],diatonic_accidentals:{unison:{note:0,accidental:0},m2:{note:1,accidental:-1},M2:{note:1,accidental:0},m3:{note:2,accidental:-1},M3:{note:2,accidental:0},p4:{note:3,accidental:0},dim5:{note:4,accidental:-1},p5:{note:4,accidental:0},m6:{note:5,accidental:-1},M6:{note:5,accidental:0},b7:{note:6,accidental:-1},M7:{note:6,accidental:0},octave:{note:7,accidental:0}},intervals:{u:0,unison:0,m2:1,b2:1,min2:1,S:1,H:1,2:2,M2:2,maj2:2,T:2,W:2,m3:3,b3:3,min3:3,M3:4,3:4,maj3:4,4:5,p4:5,"#4":6,b5:6,aug4:6,dim5:6,5:7,p5:7,"#5":8,b6:8,aug5:8,6:9,M6:9,maj6:9,b7:10,m7:10,min7:10,dom7:10,M7:11,maj7:11,8:12,octave:12},scales:{major:[2,2,1,2,2,2,1],dorian:[2,1,2,2,2,1,2],phrygian:[1,2,2,2,1,2,2],lydian:[2,2,2,1,2,2,1],mixolydian:[2,2,1,2,2,1,2],minor:[2,1,2,2,1,2,2],locrian:[1,2,2,1,2,2,2],minpent:[3,2,2,3,2],majpent:[2,2,3,2,3],blues:[3,2,1,1,3,2],harmonicminor:[2,1,2,2,1,3,1],wholetone:[2,2,2,2,2,2]},arpeggios:{maj:[4,3,5],maj7:[4,3,4,1],maj6:[4,3,2,3],maj9:[2,2,3,4,1],min:[3,4,5],minmaj7:[3,4,4,1],m7:[3,4,3,2],m6:[3,4,2,3],m69:[2,1,4,2,3],m7b5:[3,3,4,2],7:[4,3,3,2],9:[2,2,3,3,2],13:[4,3,2,1,2],"13(9)":[2,2,3,2,1,2],"7b9":[1,3,3,3,2],"13b9":[],b13b9:[],dim:[3,3,3,3]},isValidNoteValue:function(a){return null==a||0>a||a>=c.NUM_TONES?!1:!0},isValidIntervalValue:function(a){return c.isValidNoteValue(a)},getNoteParts:function(a){if(!a||a.length<1)throw new b.RERR("BadArguments","Invalid note name: "+a);if(a.length>3)throw new b.RERR("BadArguments","Invalid note name: "+a);var c=a.toLowerCase(),d=/^([cdefgab])(b|bb|n|#|##)?$/,e=d.exec(c);if(null!=e){var f=e[1],g=e[2];return{root:f,accidental:g}}throw new b.RERR("BadArguments","Invalid note name: "+a)},getKeyParts:function(a){if(!a||a.length<1)throw new b.RERR("BadArguments","Invalid key: "+a);var c=a.toLowerCase(),d=/^([cdefgab])(b|#)?(mel|harm|m|M)?$/,e=d.exec(c);if(null!=e){var f=e[1],g=e[2],h=e[3];return h||(h="M"),{root:f,accidental:g,type:h}}throw new b.RERR("BadArguments","Invalid key: "+a)},getNoteValue:function(a){var d=c.noteValues[a.toLowerCase()];if(null==d)throw new b.RERR("BadArguments","Invalid note name: "+a);return d.int_val},getIntervalValue:function(a){var d=c.intervals[a];if(null==d)throw new b.RERR("BadArguments","Invalid interval name: "+a);return d},getCanonicalNoteName:function(a){if(!c.isValidNoteValue(a))throw new b.RERR("BadArguments","Invalid note value: "+a);return c.canonical_notes[a]},getCanonicalIntervalName:function(a){if(!c.isValidIntervalValue(a))throw new b.RERR("BadArguments","Invalid interval value: "+a);return c.diatonic_intervals[a]},getRelativeNoteValue:function(a,d,e){if(null==e&&(e=1),1!=e&&-1!=e)throw new b.RERR("BadArguments","Invalid direction: "+e);var f=(a+e*d)%c.NUM_TONES;return 0>f&&(f+=c.NUM_TONES),f},getScaleTones:function(a,b){var d=[];d.push(a);for(var e=a,f=0;f<b.length;++f)e=c.getRelativeNoteValue(e,b[f]),e!=a&&d.push(e);return d},getIntervalBetween:function(a,d,e){if(null==e&&(e=1),1!=e&&-1!=e)throw new b.RERR("BadArguments","Invalid direction: "+e);if(!c.isValidNoteValue(a)||!c.isValidNoteValue(d))throw new b.RERR("BadArguments","Invalid notes: "+a+", "+d);var f;return f=1==e?d-a:a-d,0>f&&(f+=c.NUM_TONES),f}}),_.extend(a,{Theory:c})}(b),function(a){var b=a.Theory,c=function d(a){if(!(this instanceof d))throw new TypeError("tuningStr cannot be called as a function.");this._init(a)};_.extend(c,{instruments:{guitar:{"default":"EADGBe",standard:"EADGBe","drop-d":"DADGBe","open-g":"DGDGBD","open-g-dobro":"GBDGBD","open-d":"DADF#AD"},banjo:{"default":"gDGBD","open-g":"gDGBD","g-modal":"gDGCD","open-g-minor":"gDGA#D","standard-c":"gCGBD","open-d":"f#DF#AD"},mandolin:{"default":"GDAE"},bass:{"default":"EADG"}},defaultTuning:"EADGBe",isValidTuningString:function(a){return a&&_.isString(a)&&0!==a.length?null!==a.match(/^([abcdefg#]\s?)+$/gi):!1},parseTuningString:function(a){if(!c.isValidTuningString(a))throw TypeError("Invalid tuning string: "+a);if(null!==a.match(/(bb[ABCDEFGabcdefg])|(b[ABCDEFGacdefg])/g))throw TypeError("Ambiguous tuning string. Flats confused with B Notes.  Use spaces between notes: "+a);var b=[],d=a.split(" ");for(var e in d)for(var f=d[e],g=f.match(/[ABCDEFGabcdefg](bb|b|n|##|#)?/g),h=0;h<g.length;h++)b.push(g[h]);return b}}),_.extend(c.prototype,{constructor:c,_init:function(a){if(a||(a=c.defaultTuning),!c.isValidTuningString(a))throw TypeError("Invalid tuningStr: "+a);this.tuningStr=a,this.notes=c.parseTuningString(a)},getNumStrings:function(){return this.notes.length},noteValForString:function(a){return b.getNoteValue(this.noteNameForString(a))},noteNameForString:function(a){return this.notes[a]},equals:function(a){if(this.getNumStrings()!==a.getNumStrings())return!1;for(var b=0;b<this.getNumStrings();b++)if(this.notes[b]!==a.notes[b])return!1;return!0},toString:function(){return this.tuningStr}}),_.extend(a,{Tuning:c})}(b),function(a){var b=function c(a,b,d){if(!(this instanceof c))throw new TypeError("GuitarNote constructor cannot be called as a function.");this._init(a,b,d||{})};_.extend(b,{DEFAULT_OPTIONS:{muted:!1,finger:null},DEF_MUTE_ANNOTATION:"x",MUTE_ANNOTATION:"xXmM",THUMB_ANNOTATION:"tT"}),_.extend(b.prototype,{_init:function(a,c,d){if(this.options=d,_.defaults(this.options,b.DEFAULT_OPTIONS),void 0===a||null===a||!_.isNumber(a)||0>a)throw TypeError("Please provide a valid string number >= 0: "+a);if(!(this.options.muted||void 0!==c&&null!==c))throw TypeError("Please provide a valid fret: "+c);if(!(this.options.muted||_.isNumber(c)||this.isMuteAnnotation(c)))throw TypeError("Please provide a valid fret: "+c);if(_.isNumber(c)&&0>c)throw TypeError("Fret number must be >= 0: "+c);(this.isMuteAnnotation(c)||this.options.finger&&this.isMuteAnnotation(this.options.finger))&&(this.options.muted=!0),this.string=a,this.fret=c,this.finger=this.options.finger},isOpen:function(){return 0===this.fret},isMuted:function(){return this.options.muted?!0:!1},getKey:function(){return this.isMuted()?this.string+" "+b.DEF_MUTE_ANNOTATION:this.string+" "+this.fret},equals:function(a){return a&&this.string===a.string&&this.fret===a.fret&&this.finger===a.finger?this.isMuted()!=a.isMuted()?!1:!0:!1},isMuteAnnotation:function(a){return-1!==b.MUTE_ANNOTATION.indexOf(a)},isThumbAnnotation:function(a){return-1!==b.THUMB_ANNOTATION.indexOf(a)},toString:function(){var a="String: "+this.string+", Fret: "+this.fret;return this.isMuted()?a+=", Finger: "+b.DEF_MUTE_ANNOTATION:this.finger&&(a+=", Finger: "+this.finger),a}}),_.extend(a,{GuitarNote:b})}(b),function(a){var b=a.Tuning,c=a.GuitarNote,d=function e(a){if(!(this instanceof e))throw new TypeError("ChordModel cannot be called as a function.");this._init(a||{})};_.extend(d,{DEFAULT_OPTIONS:{label:"",tuning:"EADGBe"}}),_.extend(d.prototype,{_init:function(a){if(_.defaults(a,d.DEFAULT_OPTIONS),this.tuningStr=a.tuning,this.tuning=new b(this.tuningStr),this.min_fret=-1,this.max_fret=-1,!_.isString(a.label))throw TypeError("label must be a string");this.label=a.label,this.notes={},a.notes&&(this.addNotes(a.notes),_.each(a.notes,function(a){this.notes[a.getKey()]=a},this))},getNotes:function(){return this.notes},getNumNotes:function(){return _.keys(this.notes).length},getNumStrings:function(){return this.tuning.getNumStrings()},getTuning:function(){return this.tuning},getLabel:function(){return this.label},getMinFret:function(){return this.min_fret},getMaxFret:function(){return this.max_fret},addNotes:function(a){if(!_.isArray(a))throw TypeError("addNotes takes an array of notes: "+a);for(var b=0;b<a.length;b++){var c=a[b];this.addNote(c)}},addNote:function(a){if(_.isUndefined(a)||_.isNull(a))throw TypeError("Note is undefined");if(!(a instanceof c))throw TypeError("addNote requires a valid note string or GuitarNote object: "+a);if(a.string<0||a.string>=this.getNumStrings())throw TypeError("note stringNum is not valid for this chord: "+a.string);this.notes[a.getKey()]=a,_.isNumber(a.fret)&&0!==a.fret&&(-1==this.min_fret||a.fret<this.min_fret)&&(this.min_fret=a.fret),_.isNumber(a.fret)&&0!==a.fret&&(-1==this.max_fret||a.fret>this.max_fret)&&(this.max_fret=a.fret)},removeNote:function(a){var b=this._keyForNote(a);delete this.notes[b]},empty:function(){this.notes={}},transposeByInterval:function(a,b){var c={},d=a*b;for(var e in this.notes){var f=this.notes[e],g=f.fret+d;if(0>g)throw Error("Transposing causes negative fret values: "+a+" "+b);f.fret=g,c[f.getKey()]=f}this.notes=c,this.min_fret+=d,this.max_fret+=d},transposeToKey:function(a,b){if(!this.options.key&&!b)throw TypeError("No key assigned to chordmodel or passed as an argument")},equals:function(a){if(this.getNumStrings()!=a.getNumStrings()||this.getNumNotes()!=a.getNumNotes()||!this.getTuning().equals(a.getTuning())||this.getLabel()!=a.getLabel())return!1;var b,c,d=a.getNotes();for(var e in this.getNotes()){if(!_.has(d,e))return!1;if(b=this.getNotes()[e],c=d[e],!b.equals(c))return!1}return!0},toString:function(){var a,b=[];for(a=0;a<this.getTuning().notes.length;a++)b[a]=this.getTuning().notes[a]+" |--";for(var c in this.getNotes()){var d=this.notes[c];b[d.string]+=d.fret+"-"}for(a=0;a<this.getTuning().notes.length;a++)b[a]+="-|";return b.reverse().join("\n")},_keyForNote:function(a){if(!(a instanceof c))throw TypeError("addNote requires a valid note string or GuitarNote object: "+a);return a.string+" "+a.fret}}),_.extend(a,{ChordModel:d})}(b),function(b){var c=b.ChordModel,d=b.GuitarNote,e=function f(a,b,d){if(!(this instanceof f))throw new TypeError("ChordView constructor cannot be called as a function.");b||(b={}),d||(d=new c),this._init(a,b,d)};_.extend(e,{NUT_TOP:-1,NUT_LEFT:-2,FINGER_TOP:-1,FINGER_LEFT:-2,FINGER_ONNOTE:-3}),_.extend(e,{NOTE_COLORS:{black:"#000",white:"#fff",blue:"#22f",red:"#f22",green:"#0f0"},NOTE_GRADIENTS:{black:"90-#000:5-#555:95",white:"90-#eee:5-#fff:95",blue:"90-#22f:5-#55f:95",red:"90-#f22:5-#f55:95",green:"90-#0f0:5-#0f0:95"},NECK_MARKERS:[[5,1],[7,2],[9,1],[12,2],[15,1],[17,1]],UNSCALABLE:["base_fret","num_frets","min_frets","fret_pad","scale","orientation","finger_position"],DEFAULT_OPTIONS:{scale:.5,orientation:e.NUT_TOP,string_gap:30,fret_gap:30,fret_pad:1,min_frets:5,show_fingers:!0,finger_anno_y:10,finger_position:e.FINGER_TOP,anno_font_size:18,open_note_radius:6,note_radius:10,note_stroke_width:1.5,note_gradient:!0,note_color:"white",tonic_color:"black",neck_marker_radius:8,neck_marker_color:"#eee",nut_height:5,grid_x:0,grid_y:0,grid_stroke_width:1.5,grid_padding_bottom:20,grid_padding_right:20,grid_padding_left:20,show_label:!0,label_font_size:36,label_y_offset:20,label_height:40,show_tuning:!0,tuning_label_font_size:18,tuning_label_offset:14,base_fret_font_size:26,base_fret_label_width:20,base_fret_offset:16},OPTIONS_COMPACT:{scale:.3,show_tuning:!1,show_fingers:!1,note_stroke_width:1,note_color:"black",note_gradient:!1,base_fret_font_size:36,base_fret_offset:20,grid_padding_right:40,num_frets:5},OPTIONS_NECK:{scale:1,orientation:e.NUT_LEFT,show_tuning:!0,fret_gap:50,num_frets:15}}),_.extend(e,{OPTIONS:{"default":e.DEFAULT_OPTIONS,compact:e.OPTIONS_COMPACT,neck:e.OPTIONS_NECK}}),_.extend(e.prototype,{_init:function(b,c,d){if(_.isString(b))this.containerId=b.replace("#","");else if(b instanceof jQuery)this.containerId=b.attr("id");else{if(!_.isElement(b))throw TypeError("container must be a DOM elem or DOM ID string.");this.containerId=a(b).attr("id")}if(this.options={},_.isString(c)){if(!_.has(e.OPTIONS,c))throw TypeError("Invalid options string: "+c);_.defaults(this.options,e.OPTIONS[c])}else _.isObject(c)&&_.defaults(this.options,c);_.defaults(this.options,e.DEFAULT_OPTIONS),this.model=d,this.options.grid_x=this.options.grid_padding_left,this.options.grid_y=this.options.anno_font_size+4,this.options.orientation===e.NUT_TOP&&""!==this.model.getLabel()&&(this.options.grid_y+=this.options.label_height),1!=this.options.scale&&this._scaleSize(),_.has(this.options,"num_frets")&&_.has(this.options,"base_fret")||this._calcFretRange(),this.diagram_glyphs={},this.neck={glyphs:{},width:0,height:0},this.noteGlyphs={},this.transform_str="",this.width=this.options.grid_x+this.model.getNumStrings()*this.options.string_gap+this.options.base_fret_label_width+this.options.grid_padding_right,this.height=this.options.grid_y+this.options.num_frets*this.options.fret_gap+this.options.tuning_label_font_size+this.options.grid_padding_bottom,window.jQuery?a(b).html(""):_.isElement(b)&&(b.innerHtml=""),this.r=null,this.r=Raphael(this.containerId,this.width,this.height),this._render(),this._setOrientation(this.options.orientation);var f=a("#"+this.containerId).width(),g=a("#"+this.containerId).parent().width();f>g&&a("#"+this.containerId).css("width",""+g+"px")},getCode:function(){throw Error("Not implemented yet")},getModel:function(){return this.model},_scaleSize:function(){_.each(e.DEFAULT_OPTIONS,function(a,b){-1==_.indexOf(e.UNSCALABLE,b)&&_.isNumber(this.options[b])&&(this.options[b]=this.options[b]*this.options.scale)},this)},_calcFretRange:function(){var a=this.model.getMaxFret()-this.model.getMinFret(),b=a+this.options.fret_pad,c=Math.max(this.model.getMinFret(),1);_.has(this.options,"base_fret")||(this.options.base_fret=c),_.has(this.options,"num_frets")||(this.options.num_frets=Math.max(this.options.min_frets,b+(c-this.options.base_fret)))},_render:function(){this.neck.width=(this.model.getNumStrings()-1)*this.options.string_gap,this.neck.height=this.options.num_frets*this.options.fret_gap,this._drawNeck(this.options.grid_x,this.options.grid_y,this.neck.width,this.neck.height,this.model.getNumStrings()-1,this.options.num_frets,"#000"),1==this.options.base_fret?this._drawNut():this._drawBaseFret(this.options.base_fret),this.options.orientation===e.NUT_TOP&&this.options.show_label&&this._drawLabel(),this.options.show_tuning&&this._drawTuningLabel(),this._drawNotes()},_setOrientation:function(a){if(_.isString(a)){if("left"==a)return void this._setOrientation(e.NUT_LEFT);if("top"==a)return void this._setOrientation(e.NUT_TOP);throw TypeError("Invalid orientation string: "+a)}if(!_.include([e.NUT_TOP,e.NUT_LEFT],a))throw TypeError("Invalid orientation: "+a);if(a==e.NUT_TOP)this.transform_str="",this.width=this.options.grid_x+this.model.getNumStrings()*this.options.string_gap+this.options.base_fret_label_width+this.options.grid_padding_right,this.height=this.options.grid_y+this.options.num_frets*this.options.fret_gap+this.options.tuning_label_font_size+this.options.grid_padding_bottom,this.r.setSize(this.width,this.height);else if(a==e.NUT_LEFT){{this.options.grid_x+this.neck.width/2,this.options.grid_y+this.neck.height/2,-(this.width-this.height)/2,(this.height-this.width)/2}this.transform_str="r-90,0,0t-"+(this.width-(this.options.base_fret_label_width+this.options.grid_padding_right))+",0",this.height=this.options.grid_x+this.model.getNumStrings()*this.options.string_gap,this.width=this.options.grid_y+this.options.num_frets*this.options.fret_gap+this.options.tuning_label_font_size+this.options.grid_padding_bottom,this.r.setSize(this.width,this.height)}_.each(_.values(this.neck.glyphs),function(a){_.isArray(a)?_.each(a,function(a){a.transform(this.transform_str)},this):a.transform(this.transform_str)},this),_.each(_.values(this.noteGlyphs),function(b){_.each(_.values(b),function(b){b.transform(a==e.NUT_LEFT?this.transform_str+"r90":this.transform_str)},this)},this)},_drawNeck:function(a,b,c,d,e,f,g){g=g||"#000";for(var h=["M",Math.round(a)+.5,Math.round(b)+.5,"L",Math.round(a+c)+.5,Math.round(b)+.5,Math.round(a+c)+.5,Math.round(b+d)+.5,Math.round(a)+.5,Math.round(b+d)+.5,Math.round(a)+.5,Math.round(b)+.5],i=d/f,j=c/e,k=1;f>k;k++)h=h.concat(["M",Math.round(a)+.5,Math.round(b+k*i)+.5,"H",Math.round(a+c)+.5]);for(k=1;e>k;k++)h=h.concat(["M",Math.round(a+k*j)+.5,Math.round(b)+.5,"V",Math.round(b+d)+.5]);this._drawNeckMarkers(),this.neck.glyphs.grid=this.r.path(h.join(",")).attr({stroke:g,"stroke-width":this.options.grid_stroke_width})},_drawNeckMarkers:function(){this.neck.glyphs["neck-markers"]=[];for(var a=0;a<e.NECK_MARKERS.length;a++){var b=e.NECK_MARKERS[a];b[0]>this.options.base_fret&&b[0]<this.options.base_fret+this.options.num_frets&&this._drawNeckMarker(b)}},_drawNeckMarker:function(a){if(!_.isUndefined(a)){var b=this.options.grid_y+(a[0]-(this.options.base_fret-1))*this.options.fret_gap-this.options.fret_gap/2,c={fill:this.options.neck_marker_color,stroke:"none"};if(1==a[1]){var d=this.options.grid_x+this.neck.width/2,e=this.r.circle(d,b,this.options.neck_marker_radius);e.attr(c),this.neck.glyphs["neck-markers"].push(e)}else if(2==a[1]){var f=this.options.grid_x+1.2*this.options.string_gap,g=this.options.grid_x+3.8*this.options.string_gap,h=this.r.circle(f,b,this.options.neck_marker_radius);h.attr(c),this.neck.glyphs["neck-markers"].push(h);var i=this.r.circle(g,b,this.options.neck_marker_radius);i.attr(c),this.neck.glyphs["neck-markers"].push(i)}}},_drawNut:function(){var a=this.r.rect(this.options.grid_x,this.options.grid_y,(this.model.getNumStrings()-1)*this.options.string_gap,this.options.nut_height).attr({fill:"black"});this.neck.glyphs.nut=a},_drawTuningLabel:function(){var a={"font-size":this.options.tuning_label_font_size};this.neck.glyphs["tuning-labels"]=[];for(var b=0;b<this.model.getNumStrings();b++){var c=this.model.getTuning().notes[b],d=this.options.grid_x+b*this.options.string_gap,e=this.options.grid_y+this.neck.height+this.options.tuning_label_offset,f=this.r.text(d,e,""+c).attr(a);this.neck.glyphs["tuning-labels"].push(f)}},_drawBaseFret:function(a){var b=this.options.grid_x+this.neck.width+this.options.base_fret_offset,c=this.options.grid_y+this.options.fret_gap/2;this.r.text(b,c,""+a+"fr.").attr({"text-anchor":"start","font-size":this.options.base_fret_font_size})},_drawNotes:function(){_.each(this.model.getNotes(),this._drawNote,this)},_drawNote:function(a){if(_.isUndefined(a)||_.isNull(a))throw TypeError("Model has undefined note");if(a instanceof d)if(_.isUndefined(this.noteGlyphs[a.getKey()])&&(this.noteGlyphs[a.getKey()]={}),a.isMuted())this._drawMuteStringAnnotatation(a).transform(this.transform_str);else if(a.isOpen())this._drawOpenStringAnnotatation(a).transform(this.transform_str);else{var b=this._drawFretMarker(a);b&&b.transform(this.transform_str),this.options.show_fingers&&a.finger&&this._drawFingerAnnotation(a).transform(this.transform_str)}},_drawFretMarker:function(a){if(!_.isUndefined(a.fret)&&0!==a.fret&&!(a.fret<this.options.base_fret||a.fret>=this.options.base_fret+this.options.num_frets)){var b=this.options.grid_x+a.string*this.options.string_gap+.5,c=this.options.grid_y+(a.fret-this.options.base_fret+1)*this.options.fret_gap-this.options.fret_gap/2+.5,d={fill:this._colorValueForName(this.options.note_color)};d["stroke-width"]=this.options.note_stroke_width,a.options.color&&(d.fill=this._colorValueForName(a.options.color)),a.options.tonic&&(d.fill=this._colorValueForName(this.options.tonic_color),d.stroke="black");var e="chord-note";a.class&&(e=e+" "+a.class);var f=this.r.circle(b,c,this.options.note_radius);return f.node.setAttribute("class",e),f.attr(d),this.noteGlyphs[a.getKey()]["fret-marker"]=f,f}},_drawMuteStringAnnotatation:function(a){if(!_.isUndefined(a.string)){var b=this.options.grid_x+a.string*this.options.string_gap,c=this.options.grid_y-this.options.finger_anno_y,d=this.r.text(b,c,"X").attr({"font-size":this.options.anno_font_size});return this.noteGlyphs[a.getKey()]["finger-annotation"]=d,d}},_drawOpenStringAnnotatation:function(a){if(!_.isUndefined(a.string)){var b=this.options.grid_x+a.string*this.options.string_gap,c=this.options.grid_y-this.options.finger_anno_y,d=this.r.circle(b,c,this.options.open_note_radius).attr({stroke:"black",fill:"white","stroke-width":this.options.note_stroke_width});return this.noteGlyphs[a.getKey()]["finger-annotation"]=d,d}},_drawFingerAnnotation:function(a){if(!_.isUndefined(a.string)&&!_.isUndefined(a.finger)){var b,c,d={"font-size":this.options.anno_font_size};if(this.options.finger_position===e.FINGER_TOP)b=this.options.grid_x+a.string*this.options.string_gap,c=this.options.grid_y-this.options.finger_anno_y;else if(this.options.finger_position===e.FINGER_LEFT)b=this.options.grid_x+a.string*this.options.string_gap-2*this.options.note_radius+.5,c=this.options.grid_y+(a.fret-this.options.base_fret+1)*this.options.fret_gap-this.options.fret_gap/2+.5;else{if(this.options.finger_position!==e.FINGER_ONNOTE)throw TypeError("Invalid finger_position: "+this.options.finger_position);b=this.options.grid_x+a.string*this.options.string_gap+.5,c=this.options.grid_y+(a.fret-this.options.base_fret+1)*this.options.fret_gap-this.options.fret_gap/2+.5}var f=this.r.text(b,c,""+a.finger).attr(d);return this.noteGlyphs[a.getKey()]["finger-annotation"]=f,f}},_drawLabel:function(){var a=this.options.grid_x+this.neck.width/2,b=this.options.label_y_offset,c=this.model.getLabel().replace(/b/g,"♭").replace(/\#/g,"♯").replace(/\*/g,"￮");this.r.text(a,b,c).attr({"text-anchor":"middle","font-size":this.options.label_font_size})},_colorValueForName:function(a){return this.options.note_gradient?e.NOTE_GRADIENTS[a]:e.NOTE_COLORS[a]}}),_.extend(b,{ChordView:e})}(b),function(a){var b=a.GuitarNote,c=a.Tuning,d=a.ChordModel,e=a.Theory,f=function(){throw new Error("Voicings is a singleton. Do not call the constructor")};_.extend(f,{voicings:{guitar:{eadgbe:[{key:"c",label:"maj",notes:[3,3,5,5,5,"x"],fingers:[1,1,3,3,3,"x"],bass:7,tags:"gypsy"},{key:"c",label:"maj",notes:[8,10,10,9,8,8],fingers:["T",3,4,2,1,1],tags:"gypsy"},{key:"c",label:"maj",notes:[12,"x",10,12,13,"x"],fingers:[2,"x",1,3,4,"x"],bass:4,tags:"gypsy"},{key:"c",label:"maj",notes:[12,"x",14,12,13,"x"],fingers:["T","x",3,1,2,"x"],bass:4,tags:"gypsy"},{key:"c",label:"maj7",notes:["x",3,5,4,5,"x"],fingers:["x",1,3,2,4,"x"],tags:"jazz"},{key:"c",label:"maj7",notes:["x",3,5,4,5,3],fingers:["x",1,3,2,4,1],tags:"jazz"},{key:"c",label:"maj7",notes:["x",3,2,4,5,"x"],fingers:["x",2,1,3,4,"x"],tags:"jazz"},{key:"c",label:"maj7",notes:["x",3,5,5,5,7],fingers:["x",1,3,3,3,4],tags:"jazz"},{key:"g",label:"maj7",notes:[3,"x",4,4,3,"x"],fingers:[1,"x",3,4,2,"x"],tags:"jazz"},{key:"g",label:"maj7",notes:[3,5,"x",4,7,"x"],fingers:[1,3,"x",2,4,"x"],tags:"jazz"},{key:"g",label:"maj7",notes:[7,"x",5,7,7,"x"],fingers:[2,"x",1,3,4,"x"],bass:4,tags:"jazz"},{key:"g",label:"maj7",notes:["x",10,9,7,7,7],fingers:["x",4,3,1,1,1],tags:"jazz"},{key:"c",label:"maj7",notes:["x","x",10,9,8,7],fingers:["x","x",4,3,2,1],tags:"jazz"},{key:"g",label:"maj7",notes:["x",2,4,4,3,"x"],fingers:["x",1,3,4,2,"x"],base:4,tags:"jazz"},{key:"g",label:"6",notes:[3,"x",2,4,3,"x"],fingers:[2,"x",1,4,3,"x"],tags:"jazz"},{key:"g",label:"6",notes:[3,5,"x",4,5,"x"],fingers:[1,3,"x",2,4,"x"],tags:"jazz"},{key:"g",label:"6",notes:["x",7,5,7,5,"x"],fingers:["x",3,1,4,1,"x"],base:9,tags:"jazz"},{key:"g",label:"6",notes:["x",7,5,4,3,"x"],fingers:["x",4,3,2,1,"x"],base:9,tags:"jazz"},{key:"g",label:"6",notes:["x",7,5,4,3,3],fingers:["x",4,3,2,1,1],base:9,tags:"jazz"},{key:"g",label:"6",notes:["x",7,9,9,8,7],fingers:["x",1,3,4,2,1],base:9,tags:"jazz"},{key:"g",label:"6",notes:["x",7,9,7,8,"x"],fingers:["x",1,3,1,2,"x"],base:9,tags:"jazz"},{key:"c",label:"6",notes:["x",4,3,3,6,"x"],fingers:["x",2,1,1,4,"x"],tags:"jazz"},{key:"c",label:"6",notes:["x",3,5,5,5,5],fingers:["x",1,3,3,3,3],tags:"jazz"},{key:"d",label:"6",notes:["x",5,4,4,3,"x"],fingers:["x",4,2,3,1,"x"],tags:"jazz"},{key:"c",label:"6",notes:[3,3,5,5,5,5],fingers:[1,1,3,3,3,3],bass:7,tags:"gypsy"},{key:"c",label:"6",notes:[8,7,5,5,5,5],fingers:[4,3,1,1,1,1],tags:"gypsy"},{key:"c",label:"6",notes:[8,"x",10,9,10,8],fingers:["T","x",3,2,4,1],tags:"gypsy"},{key:"f",label:"maj9",notes:[5,7,5,5,5,8],fingers:[1,3,1,1,1,4],bass:4,tags:"jazz"},{key:"f",label:"maj9",notes:[5,7,5,5,8,"x"],fingers:[1,3,1,1,4,"x"],bass:4,tags:"jazz"},{key:"c",label:"maj9",notes:["x",3,2,4,3,"x"],fingers:["x",2,1,4,3],tags:"jazz"},{key:"a",label:"maj9",notes:["x",4,6,4,5,"x"],fingers:["x",1,3,1,2,"x"],bass:4,tags:"jazz"},{key:"a",label:"maj9",notes:["x",4,6,4,5,7],fingers:["x",1,3,1,2,4],bass:4,tags:"jazz"},{key:"c",label:"6/9",notes:["x",3,2,2,3,3],fingers:["x",2,1,1,3,3],tags:"jazz"},{key:"g",label:"6/9",notes:[3,"x",2,2,3,3],fingers:[2,"x",1,1,3,3],tags:"jazz"},{key:"d",label:"6/9",notes:["x",2,2,2,3,"x"],fingers:["x",1,1,1,2,"x"],bass:9,tags:"jazz"},{key:"c",label:"6/9",notes:[3,3,2,2,3,3],fingers:[2,2,1,1,3,4],bass:7,tags:"gypsy"},{key:"c",label:"6/9",notes:[8,7,7,7,8,8],fingers:[2,1,1,1,3,4],tags:"gypsy"},{key:"c",label:"6/9",notes:[8,10,10,9,10,10],fingers:["T",2,2,1,3,3],tags:"gypsy"},{key:"f",label:"7",notes:["x","x",5,4,5,3],fingers:["x","x",3,2,4,1],tags:"jazz"},{key:"f",label:"7",notes:["x",5,7,7,7,8],fingers:["x",1,3,3,3,4],tags:"jazz"},{key:"c",label:"7",notes:[3,3,5,3,5,3],fingers:[1,1,3,1,4,1],tags:"gypsy"},{key:"c",label:"7",notes:[8,"x",8,9,8,"x"],fingers:["T","x",1,3,2,"x"],tags:"gypsy"},{key:"c",label:"7",notes:[8,10,8,9,8,8],fingers:[1,3,1,2,1,1],tags:"gypsy"},{key:"c",label:"7",notes:[3,3,2,3,1,"x"],fingers:[3,3,2,4,1,"x"],bass:7,tags:"gypsy"},{key:"c",label:"7",notes:[8,10,10,9,11],fingers:["T",2,2,1,4,"x"],tags:"gypsy"},{key:"c",label:"7",notes:[6,"x",5,5,5,"x"],fingers:[2,"x",1,1,1,"x"],bass:10,tags:"gypsy"},{key:"c",label:"7",notes:[3,3,5,3,5,6],fingers:[1,1,2,1,3,4,"x"],bass:7,tags:"gypsy"},{key:"c",label:"7",notes:[8,"x",8,9,8,8],fingers:["T","x",1,4,2,3],tags:"gypsy"},{key:"b",label:"7(b5)",notes:[7,"x",7,8,6,"x"],fingers:[2,"x",3,4,1,"x"],tags:"jazz"},{key:"d",label:"7(b5)",notes:[4,"x",4,5,3,"x"],fingers:[2,"x",3,4,1,"x"],bass:6,tags:"jazz"},{key:"a",label:"7(#5)",notes:[5,"x",5,6,6,"x"],fingers:[1,"x",2,3,4,"x"],tags:"jazz"},{key:"a",label:"7(#5)",notes:[5,"x",5,6,6,"x"],fingers:["T","x",1,2,2,"x"],tags:"jazz"},{key:"d",label:"7(#5)",notes:["x",5,4,5,"x",6],fingers:["x",2,1,3,"x",4],tags:"jazz"},{key:"bb",label:"7(b9)",notes:[6,"x",6,7,6,7],fingers:["T","x",1,3,2,4],tags:"jazz"},{key:"e",label:"7(b9)",notes:["x",7,6,7,6,"x"],fingers:["x",2,1,3,1,"x"],tags:"jazz"},{key:"c",label:"7(b9)",notes:[3,3,2,3,2,"x"],fingers:[2,2,1,3,1,"x"],bass:7,tags:"gypsy jazz"},{key:"c",label:"7(b9)",notes:[12,"x",14,12,14,"x"],fingers:["T","x",2,1,3,"x"],bass:4,tags:"gypsy jazz"},{key:"c",label:"9",notes:["x",3,2,3,3,"x"],fingers:["x",2,1,3,3,"x"],tags:"jazz"},{key:"c",label:"9",notes:["x",3,2,3,3,3],fingers:["x",2,1,3,3,3],tags:"jazz"},{key:"g",label:"9",notes:[3,5,3,4,3,5],fingers:[1,3,1,2,1,4],tags:"jazz"},{key:"g",label:"9",notes:["x",2,3,2,3,"x"],fingers:["x",1,3,2,4,"x"],bass:4,tags:"jazz"},{key:"d",label:"11",notes:[5,"x",5,5,3,"x"],fingers:[2,"x",3,4,1,"x"],bass:7,tags:"jazz"},{key:"g",label:"11",notes:["x",5,3,5,3,3],fingers:["x",3,1,4,1,1],bass:7,tags:"jazz"},{key:"c",label:"11",notes:["x",3,5,3,6,"x"],fingers:["x",1,3,1,4,"x"],tags:"jazz"},{key:"a",label:"13",notes:[5,"x",5,6,7,"x"],fingers:[1,"x",2,3,4,"x"],tags:"jazz"},{key:"a",label:"13",notes:[5,"x",5,6,7,"x"],fingers:["T","x",1,2,4,"x"],tags:"jazz"},{key:"a",label:"13",notes:["x",10,9,6,7,"x"],fingers:["x",4,3,1,2,"x"],bass:11,tags:"jazz"},{key:"d",label:"13",notes:["x",5,4,5,5,7],fingers:["x",2,1,3,3,4],tags:"jazz"},{key:"d",label:"13",notes:["x","x",10,9,7,7],fingers:["x","x",4,3,1,1],bass:11,tags:"jazz"},{key:"c",label:"m",notes:[3,3,5,5,4,3],fingers:[1,1,3,4,2,1],bass:7,tags:"gypsy"},{key:"c",label:"m",notes:[8,10,10,8,8,8],fingers:["T",3,4,1,1,1],tags:"gypsy"},{key:"c",label:"m",notes:[11,"x",10,12,13],fingers:[2,"x",1,3,4,"x"],bass:3,tags:"gypsy"},{key:"c",label:"m",notes:[11,"x",13,12,13,"x"],fingers:["T","x",2,1,3,"x"],bass:3,tags:"gypsy"},{key:"c",label:"m7",notes:[8,"x",8,8,8,"x"],fingers:[2,"x",3,3,3,"x"],tags:"jazz"},{key:"e",label:"m7",notes:["x",7,5,7,5,"x"],fingers:["x",3,1,4,1,"x"],tags:"jazz"},{key:"e",label:"m7",notes:["x",7,9,7,8,"x"],fingers:["x",1,3,1,2,"x"],tags:"jazz"},{key:"e",label:"m7",notes:["x",7,9,7,8,7],fingers:["x",1,3,1,2,1],tags:"jazz"},{key:"e",label:"m7",notes:["x",7,9,7,8,10],fingers:["x",1,3,1,2,4],tags:"jazz"},{key:"e",label:"m7",notes:["x",7,5,7,8,"x"],fingers:["x",2,1,3,4,"x"],tags:"jazz"},{key:"b",label:"m7",notes:[7,9,7,7,7,10],fingers:[1,3,1,1,1,4],tags:"jazz"},{key:"b",label:"m7",notes:[7,9,7,7,10,"x"],fingers:[1,3,1,1,4,"x"],tags:"jazz"},{key:"c",label:"m7",notes:[8,"x",8,8,8,8],fingers:[2,"x",3,3,3,3],tags:"gypsy jazz"},{key:"c",label:"m7",notes:[3,3,5,3,4,3],fingers:[1,1,3,1,2,1],bass:7,tags:"gypsy"},{key:"c",label:"m7",notes:[3,"x",1,3,4,"x"],fingers:[3,"x",1,3,4,"x"],bass:7,tags:"gypsy"},{key:"c",label:"m7",notes:[8,10,8,8,8,8],fingers:["T",3,1,1,1,1],tags:"gypsy"},{key:"c",label:"m7(b5)",notes:["x",3,4,3,4,"x"],fingers:["x",1,3,2,4,"x"],tags:"gypsy"},{key:"c",label:"m7(b5)",notes:[8,"x",8,8,7,"x"],fingers:[2,"x",3,4,1,"x"],tags:"gypsy"},{key:"c",label:"m7(b5)",notes:[11,"x",10,11,11,11],fingers:[2,"x",1,3,3,3],bass:3,tags:"gypsy"},{key:"c",label:"m7(b5)",notes:[11,13,13,11,13,"x"],fingers:["T",2,2,1,3,"x"],bass:3,tags:"gypsy"},{key:"c",label:"m7(b5)",notes:[8,"x",8,8,7,8],fingers:["T","x",2,2,1,3],tags:"gypsy"},{key:"c",label:"m6",notes:[5,6,7,8,8,8],fingers:[1,2,3,4,4,4],bass:9,tags:"jazz"},{key:"c",label:"m6",notes:[5,"x",5,5,4,"x"],fingers:[2,"x",3,4,1,"x"],bass:9,tags:"jazz"},{key:"c",label:"m6",notes:[5,"x",4,5,5,"x"],fingers:[2,"x",1,3,3,"x"],tags:"jazz"},{key:"c",label:"m6",notes:[8,"x",7,8,8,8],fingers:[2,"x",1,3,3,3],tags:"gypsy"},{key:"c",label:"m6",notes:["x",12,13,12,13,"x"],fingers:["x",1,3,2,4,"x"],bass:9,tags:"gypsy jazz"},{key:"c",label:"m6",notes:[3,3,5,5,4,5],fingers:[1,1,3,1,2,1],bass:7,tags:"gypsy"},{key:"c",label:"m6",notes:[8,10,10,8,10,"x"],fingers:["T",2,2,1,3,"x"],tags:"gypsy"},{key:"c",label:"m6",notes:[8,"x",10,8,10,"x"],fingers:["T","x",3,1,4,"x"],tags:"gypsy"},{key:"d",label:"m9",notes:["x",5,3,5,5,5],fingers:["x",2,1,3,4,4],tags:"jazz"},{key:"d",label:"m9",notes:["x",5,3,5,5,"x"],fingers:["x",2,1,3,4,"x"],tags:"jazz"},{key:"a",label:"m9",notes:[5,"x",5,5,5,7],fingers:[2,"x",3,3,3,4],tags:"jazz"},{key:"g",label:"m9",notes:["x","x",8,7,6,5],fingers:["x","x",4,3,2,1],bass:4,tags:"jazz"},{key:"d",label:"m9",notes:["x",8,7,5,5,"x"],fingers:["x",4,3,1,1,"x"],bass:4,tags:"jazz"},{key:"c",label:"m6/9",notes:[8,10,10,8,10,10],fingers:["T",2,2,1,3,3],tags:"gypsy"},{key:"c",label:"*7",notes:["x",3,4,2,4,"x"],fingers:["x",2,3,1,4,"x"],tags:"gypsy"},{key:"c",label:"*7",notes:[8,"x",7,8,7,"x"],fingers:[2,"x",1,3,1,"x"],tags:"gypsy"}]},banjo:{},mandolin:{},test:{eadgbe:[{key:"c",label:"M",notes:[3,3,5,5,5,"x"],fingers:[1,1,3,3,3,"x"],bass:7},{key:"c",label:"M",notes:[8,10,10,9,8,8],fingers:["T",3,4,2,1,1]},{key:"c",label:"M",notes:[12,"x",10,12,13,"x"],fingers:[2,"x",1,3,4,"x"],bass:4},{key:"c",label:"M6",notes:[3,3,5,5,5,5],fingers:[1,1,3,3,3,3],bass:7},{key:"c",label:"M6",notes:[8,8,10,10,9,10],fingers:["T","x",3,1,2,"x"]},{key:"c",label:"M6/9",notes:[8,10,10,9,10,10],fingers:["T",2,2,1,3,3]}]}},getChordList:function(a,b){for(var c=f.voicings[a.toLowerCase()][b.toLowerCase()],d=[],e=0;e<c.length;e++){var g=c[e].label;
-1===_.indexOf(d,g)&&d.push(g)}return d},chordModelFromVoicing:function(a,g,h,i,j,k){void 0===j&&(j=0),void 0===k&&(k=!0);var l=f._getChordVoicingData(a,g,h,j,k);if(!l)return null;i||(i=l.key),i=i.toLowerCase();var m=e.getNoteValue(i),n=e.getNoteValue(l.key),o=f._bassNoteForKeyAndOffset(i,l.bass),p=i.toUpperCase()+l.label;""!==o&&(p+="/"+o.toUpperCase());for(var q=new c(g),r=[],s=0;s<l.notes.length;s++){var t=s,u=l.notes[s],v={finger:l.fingers[s]};if(_.isNumber(u)){var w=e.getRelativeNoteValue(q.noteValForString(t),u,1);w===n&&(v.color="black")}var x=new b(t,u,v);r.push(x)}var y=new d({notes:r,tuning:g,key:i,label:p}),z=e.getIntervalBetween(n,m,-1),A=e.getIntervalBetween(n,m,1),B=y.getMinFret();return B-z>=0?y.transposeByInterval(z,-1):y.transposeByInterval(A,1),y},getNumVariations:function(a,b,c,d){void 0===d&&(d=!0);for(var e=f.voicings[a.toLowerCase()][b.toLowerCase()],g=0,h=0;h<e.length;h++){var i=e[h];d||-1===i.label.indexOf(c)?d&&i.label===c&&g++:g++}return g},_getChordVoicingData:function(a,b,c,d,e){void 0===d&&(d=0),void 0===e&&(e=!0);for(var g=f.voicings[a.toLowerCase()][b.toLowerCase()],h=0,i=0;i<g.length;i++){var j=g[i];if(e||-1===j.label.indexOf(c)){if(e&&j.label===c){if(h===d)return j;h++}}else{if(h===d)return j;h++}}return null},_bassNoteForKeyAndOffset:function(a,b){if(!b)return"";var c=e.getNoteValue(a.toLowerCase()),d=e.getRelativeNoteValue(c,b,1),f=e.getCanonicalNoteName(d);return f}}),_.extend(a,{Voicings:f})}(b),function(a){var b=a.GuitarNote,c=a.Theory,d=a.Tuning,e=function f(a){if(!(this instanceof f))throw new TypeError("GuitarNoteFactory constructor cannot be called as a function.");this._init(a||{})};_.extend(e,{DEFAULT_OPTIONS:{tuning:"EADGBe",numFrets:20,minFret:0,maxFret:20}}),_.extend(e.prototype,{constructor:e,_init:function(a){if(_.defaults(a,e.DEFAULT_OPTIONS),!a.numFrets||!_.isNumber(a.numFrets)||a.numFrets<0)throw TypeError("numFrets must be valid number >= 0");this.tuning=new d(a.tuning),this.numFrets=a.numFrets,this.minFret=a.minFret,this.maxFret=a.maxFret,this.numFrets<this.maxFret&&(this.maxFret=this.numFrets),this.music=new c},notesForNotesValues:function(a){if(!a||!_.isArray(a))throw TypeError("notesValues must be an array");for(var d=[],e=0;e<a.length;e++){var f=a[e];if(!_.isNumber(f))throw TypeError("noteValue must be a number: "+f);if(0>f||f>=c.NUM_TONES)throw TypeError("noteValue must be 0 <= noteVal < 12: "+f);for(var g=0;g<this.tuning.getNumStrings();g++)for(var h=this.tuning.notes[g].toLowerCase(),i=c.getNoteValue(h),j=this.minFret;j<this.maxFret;j++){var k=(i+j)%12;if(f===k){var l=new b(g,j);d.push(l)}}}return d},notesForNotesStr:function(a){for(var b=a.split(" "),d=[],e=0;e<b.length;e++){var f=b[e].toLowerCase();if(""!==f){if(!_.has(c.noteValues,f))throw TypeError("Invalid noteStr in notesStr: "+f+" in "+a);var g=c.getNoteValue(f);d.push(g)}}return this.notesForNotesValues(d)},notesForScale:function(a,b){if(_.isUndefined(a)||_.isNull(a)||!_.isString(a)||""===a)throw TypeError("Key is required.");if(!a||!_.has(c.noteValues,a))throw TypeError("Invalid key: "+a);if(!b||!_.isString(b)||!_.has(c.scales,b))throw TypeError("Invalid scale: "+b);var d=a.toLowerCase(),e=c.getNoteValue(d),f=c.scales[b],g=[],h=e;g.push(e);for(var i=0;i<f.length;i++){var j=(h+f[i])%12;g.push(j),h=j}return this.notesForNotesValues(g)},notesForArpeggio:function(a,b){if(_.isUndefined(a)||_.isNull(a)||!_.isString(a)||""===a)throw TypeError("Key is required.");if(!a||!_.has(c.noteValues,a))throw TypeError("Invalid key: "+a);if(!b||!_.isString(b)||!_.has(c.arpeggios,b))throw TypeError("Invalid scale: "+b);var d=a.toLowerCase(),e=c.getNoteValue(d),f=c.arpeggios[b],g=[],h=e;g.push(e);for(var i=0;i<f.length;i++){var j=(h+f[i])%12;g.push(j),h=j}return this.notesForNotesValues(g)}}),_.extend(a,{GuitarNoteFactory:e})}(b),function(a){var b=a.Tuning,c=function(){throw Error("Cannot instantiate TuningFactory.")};_.extend(c,{fromInstrument:function(a,c){if(!a||!_.isString(a))throw TypeError("Must provide an instrument string");if(a=a.toLowerCase(),!_.has(b.instruments,a))throw TypeError("Invalid instrument");if(c){if(!_.isString(c))throw TypeError("tuning_type must be a string")}else c="default";if(c=c.toLowerCase(),!_.has(b.instruments[a],c))throw TypeError("Invalid tuning type: "+c);return new b(b.instruments[a][c])}}),_.extend(a,{TuningFactory:c})}(b),function(b){var c=b.ChordView,d=b.ChordModel,e=b.GuitarNote,f=b.Tuning,g=(b.ChordParserPEG,function(a){this._init(a||{})});_.extend(g,{DEFAULT_OPTIONS:{version:"0.1.0"}}),_.extend(g.prototype,{_init:function(a){_.defaults(a,g.DEFAULT_OPTIONS)},chordFromDiv:function(b){var c=a(b);if(0!==c.length){var d=c.html(),e=c.attr("id");e||(e="chord-"+Math.round(1e9*Math.random()),c.attr("id",e)),this.chordFromString(c,d)}},_trim:function(a){return a.trim?a.trim():String(a).replace(/^\s+|\s+$/g,"")},_chordModelFromParseResult:function(a){var b,c={notes:[]};a.config&&_.defaults(c,a.config);{var g=new f(c.tuning);g.getNumStrings()}if(a.strings)for(var h in a.strings){var i=a.strings[h];if(!_.isNumber(h)&&i.frets&&i.frets.length>0)for(b=0;b<i.frets.length;b++){var j=i.frets[b],k={};j.config&&_.defaults(k,j.config),k.finger=j.finger;var l=new e(i.string,j.fret,k);c.notes.push(l)}}return new d(c)},_chordViewFromParseResultAndModel:function(a,b,d){var e={};return d.config&&_.defaults(e,d.config),new c(a,e,b)},_isNumber:function(a){return!isNaN(parseFloat(a))&&isFinite(a)},_isFloat:function(a){return this._isNumber(a)&&-1!=a.indexOf(".")}}),_.extend(b,{ChordFactory:g})}(b),b});